{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const oldArrayProto = Array.prototype\r\nexport const newArrayProto = Object.create(oldArrayProto)\r\n\r\nconst methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(item => {\r\n  newArrayProto[item] = function(...args) {\r\n    const result = oldArrayProto[item].call(this, ...args)\r\n\r\n    let instered = undefined\r\n    let ob = this.__ob__\r\n\r\n    if (item === 'push' || item === 'unshift') {\r\n      instered = args\r\n    }\r\n\r\n    if (item === 'splice') {\r\n      instered = args.slice(2)\r\n    }\r\n\r\n    if (instered) {\r\n      ob.observeArray(instered)\r\n    }\r\n\r\n    return result\r\n  }\r\n})\r\n","import { newArrayProto } from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(data) {\r\n    data.__ob__ = this;\r\n\r\n    if (Array.isArray(data)) {\r\n      data.__proto__ = newArrayProto;\r\n      this.observeArray(data);\r\n      return;\r\n    }\r\n\r\n    this.walk(data);\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n\r\n  observeArray(data) {\r\n    data.forEach((item) => observe(item));\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, val) {\r\n  observe(val);\r\n\r\n  Object.defineProperty(data, key, {\r\n    configurable: true,\r\n    enumerable: true,\r\n    get() {\r\n      console.log(\"---get---\");\r\n      return val;\r\n    },\r\n\r\n    set(newVal) {\r\n      console.log(\"---set---\");\r\n      if (newVal === val) {\r\n        return;\r\n      }\r\n\r\n      val = newVal;\r\n    },\r\n  });\r\n}\r\n\r\nexport default function observe(data) {\r\n  if (typeof data !== \"object\" && data !== null) {\r\n    return;\r\n  }\r\n\r\n  if (data.__ob__ instanceof Observer) {\r\n    return data.__ob__\r\n  }\r\n\r\n  return new Observer(data);\r\n}\r\n","import observe from \"./observe/index\"\r\n\r\nexport function initState(vm) {\r\n  const options = vm.$options\r\n\r\n  if (options.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n  Object.defineProperty(vm, key, {\r\n    enumerable: true,\r\n    configurable: true,\r\n\r\n    get() {\r\n      return vm[target][key]\r\n    },\r\n\r\n    set(newVal) {\r\n      vm[target][key] = newVal\r\n    }\r\n  })\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  observe(data)\r\n\r\n  vm._data = data\r\n\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n}","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const ctx = this\r\n    ctx.$options = options\r\n\r\n    initState(ctx)\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","item","args","result","call","instered","undefined","ob","__ob__","slice","observeArray","Observer","data","isArray","__proto__","walk","keys","key","defineReactive","observe","val","defineProperty","configurable","enumerable","get","console","log","set","newVal","initState","vm","options","$options","initData","proxy","target","_data","initMixin","Vue","_init","ctx"],"mappings":"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"}